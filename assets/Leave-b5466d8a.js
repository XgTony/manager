import{u as w}from"./utils-64b53f9e.js";import{g as ee,r as u,b as le,o as ae,c as s,d as V,e as A,f as d,h as e,w as a,l as h,n as L,i as m,F as te,k as oe,m as B,y as ne,t as _}from"./index-8a49950e.js";const re={class:"user-manage"},se={class:"query-form"},pe={class:"base-table"},ue={class:"action"},de={class:"dialog-footer"},_e={__name:"Leave",setup(ie){const{proxy:f}=ee();let C=u({applyState:""});const N=u([]),b=u({pageNum:1,pageSize:10,total:0}),r=le({applyType:1,startTime:"",endTime:"",leaveTime:"0天",reasons:""}),O={startTime:[{type:"date",required:!0,message:"请输入开始日期",trigger:"change"}],endTime:[{type:"date",required:!0,message:"请输入结束日期",trigger:"change"}],reasons:[{required:!0,message:"请输入休假原因",trigger:["change","blur"]}]},i=u({}),q=u("create"),R=u([{label:"单号",prop:"orderNo",width:"120px"},{label:"休假时间",prop:"",formatter(o){return w.formateDate(new Date(o.startTime),"yyyy-MM-dd")+"到"+w.formateDate(new Date(o.endTime),"yyyy-MM-dd")},width:"120px"},{label:"休假时长",prop:"leaveTime",width:"80px"},{label:"休假类型",prop:"applyType",formatter(o,l,n){return{1:"事假",2:"调休",3:"年假"}[n]},width:"80px"},{label:"休假原因",prop:"reasons",width:"80px"},{label:"申请时间",prop:"createTime",width:180,formatter:(o,l,n)=>w.formateDate(new Date(n))},{label:"审批人",prop:"auditUsers"},{label:"当前审批人",prop:"curAuditUserName",width:"80px"},{label:"审批状态",prop:"applyState",formatter:(o,l,n)=>({1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"})[n]}]);let y=u(!1),g=u(!1);const k=u(null),E=u(null);ae(()=>{T()});const T=async()=>{let o=await f.$api.getApplyList();console.log(o),N.value=o.list,b.value=o.page},I=()=>{T()},j=()=>{y.value=!0,q.value="create"},G=o=>{let l={...o};l.applyTypeName={1:"事假",2:"调休",3:"年假"}[l.applyType],l.time=w.formateDate(new Date(l.startTime),"yyyy-MM-dd")+"到"+w.formateDate(new Date(l.endTime),"yyyy-MM-dd"),l.applyStateName={1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"}[l.applyState],i.value=l,g.value=!0,console.log(o)},H=async o=>{try{let l={_id:o,action:"delete"},n=await f.$api.leaveOperate(l);f.$message.success("删除成功"),T()}catch{}},J=o=>{b.value.pageNum=o},M=(o,l)=>{let{startTime:n,endTime:v}=r;!n||!v||(n>v?(f.$message.error("开始日期不能晚于结束日期"),r.leaveTime="0天",setTimeout(()=>{r[o]=""},0)):r.leaveTime=(v-n)/(24*60*60*1e3)+1+"天")},U=()=>{y.value=!1,k.value.resetFields()},K=()=>{k.value.validate(async o=>{if(o)try{let l={...r,action:q.value},n=await f.$api.leaveOperate(l);f.$message.success("创建成功"),U(),T()}catch{}})};return(o,l)=>{const n=s("el-option"),v=s("el-select"),p=s("el-form-item"),c=s("el-button"),D=s("el-form"),F=s("el-table-column"),P=s("el-table"),Q=s("el-pagination"),$=s("el-date-picker"),S=s("el-col"),W=s("el-row"),X=s("el-input"),z=s("el-dialog"),x=s("el-step"),Y=s("el-steps");return V(),A("div",re,[d("div",se,[e(D,{ref:"form",inline:!0,model:h(C)},{default:a(()=>[e(p,{label:"审批状态",prop:"applyState"},{default:a(()=>[e(v,{modelValue:h(C).applyState,"onUpdate:modelValue":l[0]||(l[0]=t=>h(C).applyState=t)},{default:a(()=>[e(n,{value:"",label:"全部"}),e(n,{value:1,label:"待审批"}),e(n,{value:2,label:"审批中"}),e(n,{value:3,label:"审批拒绝"}),e(n,{value:4,label:"审批通过"}),e(n,{value:5,label:"作废"})]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:a(()=>[e(c,{type:"primary",onClick:T},{default:a(()=>[m("查询")]),_:1}),e(c,{onClick:l[1]||(l[1]=t=>I("form"))},{default:a(()=>[m("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),d("div",pe,[d("div",ue,[e(c,{type:"primary",onClick:j},{default:a(()=>[m("申请休假")]),_:1})]),e(P,{data:N.value,ref_key:"table",ref:E},{default:a(()=>[(V(!0),A(te,null,oe(R.value,t=>(V(),B(F,{key:t.prop,prop:t.prop,label:t.label,width:t.width,formatter:t.formatter},null,8,["prop","label","width","formatter"]))),128)),e(F,{label:"操作",width:"200"},{default:a(t=>[e(c,{size:"mini",onClick:Z=>G(t.row)},{default:a(()=>[m("查看")]),_:2},1032,["onClick"]),[1,2].includes(t.row.applyState)?(V(),B(c,{key:0,type:"danger",size:"mini",onClick:Z=>H(t.row._id)},{default:a(()=>[m("作废")]),_:2},1032,["onClick"])):ne("",!0)]),_:1})]),_:1},8,["data"]),e(Q,{class:"pagination",background:"",layout:(o.prev,b.value,o.next),total:b.value.total,"page-size":b.value.pageSize,onCurrentChange:J},null,8,["layout","total","page-size"])]),e(z,{title:"申请休假",modelValue:h(y),"onUpdate:modelValue":l[8]||(l[8]=t=>L(y)?y.value=t:y=t),width:"70%"},{footer:a(()=>[d("span",de,[e(c,{onClick:U},{default:a(()=>[m("取 消")]),_:1}),e(c,{type:"primary",onClick:K},{default:a(()=>[m("确 定")]),_:1})])]),default:a(()=>[e(D,{ref_key:"dialogForm",ref:k,model:r,"label-width":"120px",rules:O},{default:a(()=>[e(p,{label:"休假类型",prop:"applyType",required:""},{default:a(()=>[e(v,{modelValue:r.applyType,"onUpdate:modelValue":l[2]||(l[2]=t=>r.applyType=t)},{default:a(()=>[e(n,{label:"事假",value:1}),e(n,{label:"调休",value:2}),e(n,{label:"年假",value:3})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"休假类型",required:""},{default:a(()=>[e(W,null,{default:a(()=>[e(S,{span:8},{default:a(()=>[e(p,{prop:"startTime",required:""},{default:a(()=>[e($,{modelValue:r.startTime,"onUpdate:modelValue":l[3]||(l[3]=t=>r.startTime=t),type:"date",placeholder:"选择开始日期",onChange:l[4]||(l[4]=t=>M("startTime",t))},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:1},{default:a(()=>[m("-")]),_:1}),e(S,{span:8},{default:a(()=>[e(p,{prop:"endTime",required:""},{default:a(()=>[e($,{modelValue:r.endTime,"onUpdate:modelValue":l[5]||(l[5]=t=>r.endTime=t),type:"date",placeholder:"选择结束日期",onChange:l[6]||(l[6]=t=>M("endTime",t))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{label:"休假时长",required:""},{default:a(()=>[m(_(r.leaveTime),1)]),_:1}),e(p,{label:"休假原因",prop:"reasons",required:""},{default:a(()=>[e(X,{type:"textarea",row:3,placeholder:"请输入休假原因",modelValue:r.reasons,"onUpdate:modelValue":l[7]||(l[7]=t=>r.reasons=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(z,{title:"申请休假详情",width:"50%",modelValue:h(g),"onUpdate:modelValue":l[9]||(l[9]=t=>L(g)?g.value=t:g=t),"destroy-on-close":""},{default:a(()=>[e(Y,{active:i.value.applyState>2?3:i.value.applyState,"align-center":""},{default:a(()=>[e(x,{title:"待审批"}),e(x,{title:"审批中"}),e(x,{title:"审批通过/审批拒绝"})]),_:1},8,["active"]),e(D,{"label-width":"120px","label-suffix":":"},{default:a(()=>[e(p,{label:"休假类型"},{default:a(()=>[d("div",null,_(i.value.applyTypeName),1)]),_:1}),e(p,{label:"休假时间"},{default:a(()=>[d("div",null,_(i.value.time),1)]),_:1}),e(p,{label:"休假时长"},{default:a(()=>[d("div",null,_(i.value.leaveTime),1)]),_:1}),e(p,{label:"休假原因"},{default:a(()=>[d("div",null,_(i.value.reasons),1)]),_:1}),e(p,{label:"审批状态"},{default:a(()=>[d("div",null,_(i.value.applyStateName),1)]),_:1}),e(p,{label:"审批人"},{default:a(()=>[d("div",null,_(i.value.curAuditUserName),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{_e as default};

import{g as G,o as H,r as p,c as n,d as f,e as h,f as y,h as l,w as t,l as v,n as J,i as m,F as $,k as U,m as x,x as K}from"./index-8a49950e.js";const Q={class:"dept-manage"},W=["model"],X={class:"base-table"},Y={class:"action"},Z={class:"dialog-footer"},ae={__name:"Dept",setup(ee){const{proxy:c}=G();H(()=>{b(),L()});let g=p({deptName:""});const k=p(null);let _=p("create"),i=p(!1);const C=p([]),E=p([{label:"部门名称",prop:"deptName"},{label:"负责人",prop:"userName"},{label:"更新时间",prop:"updateTime",formatter(o,a,s){return s.substring(0,10)}},{label:"创建时间",prop:"createTime",formatter(o,a,s){return s.substring(0,10)}}]),N=p([]),r=p([]),F=p({parentId:[{required:!0,message:"请选择上级部门",trigger:"blur"}],deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"}],user:[{required:!0,message:"请选择负责人",trigger:"blur"}]}),b=async()=>{let o=await c.$api.getDeptList();N.value=o},L=async()=>{let o=await c.$api.getAllUserList();console.log(o),C.value=o},D=()=>{g.value.deptName=""},q=o=>{_.value="edit",i.value=!0;let{parentId:a,deptName:s,userName:u,userEmail:d}=o,V={parentId:a,deptName:s,user:u,userEmail:d};c.$nextTick(()=>{r.value=V})},B=()=>{_.value="create",i.value=!0},w=()=>{i.value=!1,k.value.resetFields()},T=o=>{_.value="delete",o.userId,_.value,c.$message.success("删除成功"),b()},M=()=>{k.value.validate(async o=>{if(o){let a={...r.value,action:_.value};delete a.user,await c.$api.deptOperate(a),c.$message.success("操作成功"),w(),b()}})},O=o=>{console.log(o);const[a,s,u]=o.split("/");Object.assign(r.value,{userId:a,userName:s,userEmail:u})};return(o,a)=>{const s=n("el-input"),u=n("el-form-item"),d=n("el-button"),V=n("el-form"),I=n("el-table-column"),R=n("el-table"),S=n("el-cascader"),j=n("el-option"),A=n("el-select"),P=n("el-dialog");return f(),h("div",Q,[y("div",{class:"query-form",ref:"",model:v(g)},[l(V,{inline:!0},{default:t(()=>[l(u,{label:"部门名称"},{default:t(()=>[l(s,{placeholder:"请输入部门名称",modelValue:v(g).deptName,"onUpdate:modelValue":a[0]||(a[0]=e=>v(g).deptName=e)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(d,{type:"primary",onClick:b},{default:t(()=>[m("查询")]),_:1}),l(d,{onClick:D},{default:t(()=>[m("重置")]),_:1})]),_:1})]),_:1})],8,W),y("div",X,[y("div",Y,[l(d,{type:"primary",onClick:B},{default:t(()=>[m("创建")]),_:1})]),l(R,{data:N.value,"row-key":"_id","tree-props":{children:"children"}},{default:t(()=>[(f(!0),h($,null,U(E.value,e=>(f(),x(I,K({key:e.prop},e),null,16))),128)),l(I,{label:"操作"},{default:t(e=>[l(d,{type:"primary",onClick:z=>q(e.row)},{default:t(()=>[m("编辑")]),_:2},1032,["onClick"]),l(d,{type:"danger",onClick:z=>T(e.row)},{default:t(()=>[m("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),l(P,{title:v(_)==="create"?"创建部门":"编辑部门",modelValue:v(i),"onUpdate:modelValue":a[5]||(a[5]=e=>J(i)?i.value=e:i=e)},{footer:t(()=>[y("span",Z,[l(d,{onClick:w},{default:t(()=>[m("取消")]),_:1}),l(d,{type:"primary",onClick:M},{default:t(()=>[m(" 确认 ")]),_:1})])]),default:t(()=>[l(V,{ref_key:"dialogForm",ref:k,model:r.value,rules:F.value,"label-width":"120px"},{default:t(()=>[l(u,{prop:"parentId",label:"上级部门"},{default:t(()=>[l(S,{placeholder:"请选择上级部门",modelValue:r.value.parentId,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value.parentId=e),clearable:"",props:{checkStrictly:!0,value:"_id",label:"deptName"},options:N.value,"show-all-levels":!0},null,8,["modelValue","options"])]),_:1}),l(u,{label:"部门名称",prop:"deptName"},{default:t(()=>[l(s,{placeholder:"请输入部门名称",modelValue:r.value.deptName,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value.deptName=e)},null,8,["modelValue"])]),_:1}),l(u,{label:"部门负责人",prop:"user"},{default:t(()=>[l(A,{placeholder:"请选择部门负责人",modelValue:r.value.user,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value.user=e),onChange:O},{default:t(()=>[(f(!0),h($,null,U(C.value,e=>(f(),x(j,{key:e.userId,label:e.userName,value:`${e.userId}/${e.userName}/${e.userEmail}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"负责人邮箱",prop:"userEmail"},{default:t(()=>[l(s,{placeholder:"请输入负责人邮箱",modelValue:r.value.userEmail,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value.userEmail=e),disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}};export{ae as default};

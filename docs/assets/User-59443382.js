import{o as ee,r as f,g as le,b as _,c as d,d as V,e as $,f as h,h as e,w as t,i as c,F,k as S,l as ae,m as T}from"./index-27630fba.js";const te={class:"user-manager"},oe={class:"query-form"},se={class:"base-table"},ne={class:"action"},re={class:"dialog-footer"},pe={__name:"User",setup(ue){ee(()=>{v(),P(),Q()});const L=f(null),y=f(null),{proxy:u}=le();let g=f("add");const p=_({userId:"",userName:"",state:1}),b=f(!1),s=_({}),k=_([]),C=_({pageNum:1,pageSize:10}),w=f([]),j=_({userName:[{required:!0,message:"请输入用户名称",trigger:"blur"}],userEmail:[{required:!0,message:"请输入用户邮箱",trigger:"blur"}]}),B=_([{label:"用户ID",prop:"userId"},{label:"用户名称",prop:"userName"},{label:"用户邮箱",prop:"userEmail"},{label:"用户角色",prop:"role",formatter(o,l,n){return{0:"管理员",1:"普通用户"}[n]}},{label:"用户状态",prop:"state",formatter(o,l,n){return{1:"在职",2:"离职",3:"试用期"}[n]}},{label:"注册时间",prop:"createTime"},{label:"最后登录时间",prop:"lastLoginTime"}]),D=f([]),E=f([]),v=async()=>{let o={...p,...C};try{let{list:l,page:n}=await u.$api.getUserList(o);k.length=0,l.forEach(r=>{k.push(r)}),C.total=n.total}catch(l){console.log(l)}},q=()=>{v()},N=o=>{o.resetFields()},z=o=>{C.pageNum=o},M=async o=>{await u.$api.deleteUser({userIds:[o.userId]}),u.$message.success("删除成功"),v()},R=async()=>{if(w.value.length===0){u.$message.error("请选择要删除的用户");return}(await u.$api.deleteUser({userIds:w.value})).nModified>0?(u.$message.success("删除成功"),v()):u.$message.error("删除失败")},A=o=>{let l=[];o.map(n=>{l.push(n.userId)}),w.value=l},O=()=>{g.value="add",b.value=!0},P=async()=>{let o=await u.$api.getDeptList();E.value=o},Q=async()=>{let o=await u.$api.getRoleAllList();D.value=o},G=()=>{b.value=!1,N(y.value)},H=()=>{y.value.validate(async o=>{if(o){console.log({...s,action:g});let l=await u.$api.userSubmit({...s,action:g.value});console.log(l),b.value=!1,u.$message.success("用户创建成功"),N(y.value),v()}})},J=o=>{g.value="edit",console.log(o),b.value=!0,u.$nextTick(()=>{Object.assign(s,o)})};return(o,l)=>{const n=d("el-input"),r=d("el-form-item"),i=d("el-option"),I=d("el-select"),m=d("el-button"),x=d("el-form"),U=d("el-table-column"),K=d("el-table"),W=d("el-pagination"),X=d("el-cascader"),Y=d("el-dialog");return V(),$("div",te,[h("div",oe,[e(x,{inline:!0,model:p,ref_key:"form",ref:L},{default:t(()=>[e(r,{label:"用户id",prop:"userId"},{default:t(()=>[e(n,{modelValue:p.userId,"onUpdate:modelValue":l[0]||(l[0]=a=>p.userId=a),placeholder:"请输入用户ID"},null,8,["modelValue"])]),_:1}),e(r,{label:"用户名称",prop:"userName"},{default:t(()=>[e(n,{modelValue:p.userName,"onUpdate:modelValue":l[1]||(l[1]=a=>p.userName=a),placeholder:"请输入用户名称"},null,8,["modelValue"])]),_:1}),e(r,{label:"用户状态",prop:"state"},{default:t(()=>[e(I,{modelValue:p.state,"onUpdate:modelValue":l[2]||(l[2]=a=>p.state=a)},{default:t(()=>[e(i,{value:0,label:"所有"}),e(i,{value:1,label:"在职"}),e(i,{value:2,label:"离职"}),e(i,{value:3,label:"试用期"})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(m,{type:"primary",onClick:q},{default:t(()=>[c("查询")]),_:1}),e(m,{onClick:l[3]||(l[3]=a=>N(L.value))},{default:t(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),h("div",se,[h("div",ne,[e(m,{type:"primary",onClick:O},{default:t(()=>[c("新增")]),_:1}),e(m,{type:"danger",onClick:l[4]||(l[4]=a=>R())},{default:t(()=>[c("批量删除")]),_:1})]),e(K,{data:k,style:{width:"100%"},onSelectionChange:A},{default:t(()=>[e(U,{type:"selection",width:"50"}),(V(!0),$(F,null,S(B,a=>(V(),T(U,{key:a.prop,prop:a.prop,label:a.label,formatter:a.formatter},null,8,["prop","label","formatter"]))),128)),e(U,{label:"操作",width:"150"},{default:t(a=>[e(m,{size:"small",type:"primary",onClick:Z=>J(a.row)},{default:t(()=>[c("编辑")]),_:2},1032,["onClick"]),e(m,{type:"danger",size:"small",onClick:Z=>M(a.row)},{default:t(()=>[c("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(W,{class:"pagination",background:"",layout:"prev, pager, next",total:C.total,onCurrentChange:z},null,8,["total"])]),e(Y,{modelValue:b.value,"onUpdate:modelValue":l[12]||(l[12]=a=>b.value=a),title:"用户新增"},{footer:t(()=>[h("span",re,[e(m,{onClick:G},{default:t(()=>[c("取消")]),_:1}),e(m,{type:"primary",onClick:H},{default:t(()=>[c(" 确认 ")]),_:1})])]),default:t(()=>[e(x,{ref_key:"dialogForm",ref:y,model:s,"label-width":"100px",rules:j},{default:t(()=>[e(r,{label:"用户名",prop:"userName"},{default:t(()=>[e(n,{modelValue:s.userName,"onUpdate:modelValue":l[5]||(l[5]=a=>s.userName=a),placeholder:"请输入用户名称",disabled:ae(g)==="edit"},null,8,["modelValue","disabled"])]),_:1}),e(r,{label:"邮箱",prop:"userEmail"},{default:t(()=>[e(n,{modelValue:s.userEmail,"onUpdate:modelValue":l[6]||(l[6]=a=>s.userEmail=a),placeholder:"请输入用户邮箱"},null,8,["modelValue"])]),_:1}),e(r,{label:"手机号",prop:"mobile"},{default:t(()=>[e(n,{modelValue:s.mobile,"onUpdate:modelValue":l[7]||(l[7]=a=>s.mobile=a),placeholder:"请输入用户电话"},null,8,["modelValue"])]),_:1}),e(r,{label:"岗位",prop:"job"},{default:t(()=>[e(n,{modelValue:s.job,"onUpdate:modelValue":l[8]||(l[8]=a=>s.job=a),placeholder:"请输入用户岗位"},null,8,["modelValue"])]),_:1}),e(r,{label:"状态",prop:"state"},{default:t(()=>[e(I,{modelValue:s.state,"onUpdate:modelValue":l[9]||(l[9]=a=>s.state=a)},{default:t(()=>[e(i,{value:"1",label:"在职"}),e(i,{value:"2",label:"离职"}),e(i,{value:"3",label:"试用期"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"系统角色",prop:"roleList"},{default:t(()=>[e(I,{modelValue:s.roleList,"onUpdate:modelValue":l[10]||(l[10]=a=>s.roleList=a),placeholder:"请选择用户角色",multiple:"",style:{width:"100%"}},{default:t(()=>[(V(!0),$(F,null,S(D.value,a=>(V(),T(i,{key:a._id,label:a.roleName,value:a.roleName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"部门",prop:"deptId"},{default:t(()=>[e(X,{modelValue:s.deptId,"onUpdate:modelValue":l[11]||(l[11]=a=>s.deptId=a),placeholder:"请选择所在部门",options:[...E.value],props:{checkStrictly:!0,value:"_id",label:"deptName"},onChange:o.handleChange,clearable:""},null,8,["modelValue","options","onChange"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}};export{pe as default};
